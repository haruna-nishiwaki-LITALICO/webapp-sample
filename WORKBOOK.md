# テスト技法練習ドリル

この資料には、このWebアプリで練習することのできるテスト技法に関する問題と回答を記載します。

## 問題1: 同値分割

**シナリオ**  管理者ログインフォーム（`login.html`）ではユーザーIDとパスワードの組み合わせを認証する。仕様は`app.py`の`USERS`定義と`/login`ルートの処理を参照。

**質問**  認証の妥当性を検証するための入力の同値クラスを列挙し、代表値を挙げよ。最低限、正常系1クラスと異常系3クラスを含めること。

**回答**
- 正常系: `admin` / `admin_password` など登録済みIDと正しいパスワードの組み合わせ。
- 異常系1: 未登録ID（例: `guest`）。
- 異常系2: 登録済みIDだが誤ったパスワード（例: `admin` / `wrong`）。
- 異常系3: 空IDまたは空パスワード（例: `""` / `admin_password`）。
- 異常系4: 前後に空白を含む入力（例: `" admin"` / `admin_password`）。`strip()`処理によりIDだけがトリミングされる実装に着目する。

## 問題2: 境界値分析

**シナリオ**  商品登録フォーム（`product_form.html`）では価格`price`フィールドが整数で0以上1,000,000以下である必要がある。バリデーションは`validate_product_form`内の`parse_int`呼び出しを参照。

**質問**  代表的境界値テストケースを列挙し、期待結果を記載せよ。

**回答**
- `price=-1` → エラー「0以上1000000以下で入力してください。」
- `price=0` → 正常。商品登録成功。
- `price=1` → 正常。商品登録成功。
- `price=999999` → 正常。商品登録成功。
- `price=1000000` → 正常。商品登録成功。
- `price=1000001` → エラー「0以上1000000以下で入力してください。」
- `price="ABC"` → エラー「数値を入力してください。」
- `price=""` → エラー「必須入力です。」

## 問題3: デシジョンテーブル

**シナリオ**  商品一覧の在庫表示ロジック（`stock_indication`）では在庫数`stock`に応じてラベルとCSSクラスが変化する。

**質問**  デシジョンテーブルを作成し、各条件に対する期待表示をまとめよ。またテーブルをもとに網羅的なテストケースを導出せよ。

**回答**  条件は `stock == 0`、`1 <= stock <= 10`、`stock >= 11` の3状態で排他的。

| 条件 | 在庫切れ (`stock==0`) | 残りわずか (`1<=stock<=10`) | 在庫あり (`stock>=11`) | 期待表示 |
| --- | --- | --- | --- | --- |
| 1 | T | F | F | ラベル「在庫切れ」、クラス`stock-empty` |
| 2 | F | T | F | ラベル「残りわずか」、クラス`stock-low` |
| 3 | F | F | T | ラベル「在庫あり」、クラス`stock-ok` |

導出テストケース例: `stock=0`、`stock=5`、`stock=11` の3ケース。

## 問題4: 状態遷移テスト

**シナリオ**  商品のステータスは`allowed_status_transitions`に従って遷移する。`準備中 → 公開中/非公開 → 公開中/非公開`の制約がある。

**質問**  状態遷移図を読み取り、遷移テストの最小カバレッジを満たすテストシーケンスを1つ示せ。また不正遷移の検出ケースも提示せよ。

**回答**
- 有効遷移網羅を満たすシーケンス例: `準備中`で登録 → 編集で`公開中`へ → 編集で`非公開`へ → 編集で`公開中`へ。
- 不正遷移検出例: `公開中`から`準備中`へ直接変更を要求 → エラー「このステータスには変更できません。」を期待。

## 問題5: 組合せテスト（ペアワイズ）

**シナリオ**  商品検索（`/products`）ではキーワード、カテゴリ、最小価格、最大価格が入力可能。ただし数値以外の価格には警告が表示される。

**質問**  各入力因子を2値に簡略化し、ペアワイズテストの設計例を示せ。因子例: キーワード(`空`/`部分一致語`)、カテゴリ(`指定なし`/`書籍`)、最小価格(`空`/`有効`)、最大価格(`空`/`無効文字列`)。

**回答**
- 因子水準の例: キーワード=`空` or `"テスト"`; カテゴリ=`""` or `"書籍"`; 最小価格=`""` or `"1000"`; 最大価格=`""` or `"ABC"`。
- オーソドックスなペアワイズ生成例（4ケース）:
	1. (`空`,`""`,`""`,`""`) → 検索条件なし。全件表示。
	2. (`空`,`"書籍"`,`"1000"`,`""`) → カテゴリと下限の組み合わせでフィルタ。
	3. (`"テスト"`,`""`,`""`,`"ABC"`) → キーワードと最大価格の無効入力 → 警告「価格は数値で入力してください。」期待。
	4. (`"テスト"`,`"書籍"`,`"1000"`,`"ABC"`) → 有効/無効の混在で主要ペアを網羅。

## 問題6: エラーハンドリングとフェールセーフ

**シナリオ**  商品一覧でキーワードに`"バグ票"`を含めると意図的に`RuntimeError`が発生し500エラーとなる。

**質問**  フェールセーフの観点から期待される改善案を述べ、テスト観点を2点列挙せよ。

**回答**
- 改善案例: 意図的エラーをHTTP 400など制御されたレスポンスに変換し、ユーザー向けメッセージを表示する。もしくは監視用ロギングにとどめUIは継続。
- テスト観点例:
	- キーワードに`バグ票`を含む場合にエラーメッセージが適切に表示され、アプリが落ちないこと。
	- エラー発生時に監査用ログが出力され、他の検索条件（カテゴリや価格入力）が初期化されないこと。

## 問題7: 因子水準表

**シナリオ**  商品登録フォームでは`category`、`status`、`stock`、`price`といった複数因子が存在し、`status`は新規登録時には「準備中」固定だが編集時は`STATUSES`全てが候補となる。

**質問**  新規登録と編集の場合で因子水準表を作成せよ。因子はカテゴリ、ステータス、在庫、価格とする。価格と在庫は区分で整理し、各水準が重複なく網羅されるようにすること。

**回答**
- **新規登録時**
	- カテゴリ: {書籍, 家電, 食品, その他}
	- ステータス: {準備中}
	- 在庫: {0（欠品）, 1-10（少量）, 11以上（潤沢）}
	- 価格: {0（無料）, 1-999（低価格帯）, 1000-99999（中価格帯）, 100000以上（高価格帯）}
- **編集時**
	- カテゴリ: {書籍, 家電, 食品, その他}
	- ステータス: {準備中, 公開中, 非公開}
	- 在庫: {0, 1-10, 11以上}
	- 価格: {0, 1-999, 1000-99999, 100000以上}
